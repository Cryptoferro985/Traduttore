<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traduzione Semplice V3</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f8fafc; --card: #ffffff; --accent: #10b981; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 90%; max-width: 400px; background: var(--card); padding: 25px; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        .box { text-align: left; background: #f1f5f9; padding: 18px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .btn { border: none; padding: 18px; border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer; width: 100%; margin-bottom: 10px; color: white; }
        #btn-trad { background: var(--accent); }
        #btn-eser { background: var(--primary); display: none; }
        .audio-btn { position: absolute; right: 15px; top: 40%; background: white; border: 1px solid #ddd; border-radius: 50%; width: 40px; height: 40px; display: none; align-items: center; justify-content: center; font-size: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="titolo" style="font-size: 18px; color: var(--primary); margin-bottom: 20px;">Traduzione Semplice</h2>
    
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <select id="sel-target" style="flex:1; padding:12px; border-radius:12px;">
            <option value="th-TH">ðŸ‡¹ðŸ‡­ Thai</option>
            <option value="en-US">ðŸ‡ºðŸ‡¸ Inglese</option>
        </select>
    </div>

    <div class="box">
        <div style="font-size: 10px; font-weight: 800; color: #64748b;">PRONUNCIA (LEGGIBILE)</div>
        <div id="out-fonetica" style="font-size: 24px; font-weight: 800; color: var(--primary); margin: 8px 0;">---</div>
        <div id="out-originale" style="font-size: 14px; color: #64748b;">---</div>
        <button id="btn-audio-solo" class="audio-btn" onclick="riproduci()">ðŸ”Š</button>
    </div>

    <button id="btn-trad" class="btn" onclick="avviaTraduzione()">PARLA IN ITALIANO</button>
    <button id="btn-eser" class="btn" onclick="avviaEsercitazione()">ESERCITAZIONE</button>
</div>

<script>
    let motore = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    let stringaTradotta = "";

    function parlaTesto(t, l) {
        window.speechSynthesis.cancel();
        let voce = new SpeechSynthesisUtterance(t);
        voce.lang = l; voce.rate = 0.75;
        window.speechSynthesis.speak(voce);
    }

    function riproduci() {
        if(stringaTradotta) parlaTesto(stringaTradotta, document.getElementById('sel-target').value);
    }

    async function avviaTraduzione() {
        motore.lang = "it-IT";
        motore.onresult = async (e) => {
            const voceIt = e.results[0][0].transcript;
            const langT = document.getElementById('sel-target').value;
            const r = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=it&tl=${langT.split('-')[0]}&dt=t&dt=rm&q=${encodeURIComponent(voceIt)}`);
            const d = await r.json();
            
            stringaTradotta = d[0][0][0];
            let fonetica = (d[0][1] && d[0][1][3]) ? d[0][1][3] : (d[0][0][3] || stringaTradotta);
            fonetica = fonetica.normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            document.getElementById('out-fonetica').innerText = fonetica;
            document.getElementById('out-originale').innerText = stringaTradotta;
            document.getElementById('btn-eser').style.display = "block";
            document.getElementById('btn-audio-solo').style.display = "flex";
            parlaTesto(stringaTradotta, langT);
        };
        motore.start();
    }

    function avviaEsercitazione() {
        const langT = document.getElementById('sel-target').value;
        motore.lang = langT;
        motore.onresult = (e) => {
            const detto = e.results[0][0].transcript.toLowerCase();
            const atteso = stringaTradotta.toLowerCase();
            if (detto.includes(atteso) || atteso.includes(detto) || detto.length > 2) {
                alert("BRAVO! Pronuncia corretta.");
                parlaTesto("Ottimo lavoro", "it-IT");
            } else {
                alert("RIPROVA! Hai detto: " + detto);
                parlaTesto("Riprova", "it-IT");
            }
        };
        motore.start();
    }
</script>
</body>
</html>
